using YPrime.Core.BusinessLayer.Interfaces;
using YPrime.Core.BusinessLayer.Models;
using YPrime.Core.BusinessLayer.Services;

namespace YPrime.BusinessLayer.UnitTests.Services.QuestionnaireServiceTests
{
    public abstract class QuestionnaireServiceTestBase : ConfigServiceTestBase<QuestionnaireModel>
    {
        protected string ExpectedBaseEndpointAddress = $"{BaseTestHttpAddress}/Questionnaire";

        protected const string AllQuestionnairesResponse = "[{\"pages\":[{\"displayName\":\"Page 1\",\"footerText\":\"\",\"id\":\"5d78079b-3421-495a-b40e-3181e1206298\",\"internalName\":\"Page 1\",\"sequence\":1}],\"questionnaireTaker\":{\"deviceType\":\"Tablet\",\"questionnaireTypeName\":\"Patient\",\"uiName\":\"Subject\",\"questionnaireTypeID\":2,\"isTraining\":false},\"id\":\"d63f9b76-a70a-4529-bd64-0a654fc4d9fa\",\"internalName\":\"Tablet Questionnaire\",\"displayName\":\"Tablet Questionnaire\",\"sequence\":1,\"questionnaireTypeId\":2},{\"pages\":[{\"displayName\":\"QuestionnairePage1\",\"footerText\":\"\",\"id\":\"de7a8ab8-b5a4-4498-a084-df2c4633cc1d\",\"internalName\":\"QuestionnairePage1\",\"sequence\":1}],\"questionnaireTaker\":{\"deviceType\":\"Tablet\",\"questionnaireTypeName\":\"Patient\",\"uiName\":\"Subject\",\"questionnaireTypeID\":2,\"isTraining\":false},\"id\":\"e4cc6e6c-05fb-4c37-90c8-b7fad6959eb3\",\"internalName\":\"Questionnaire1\",\"displayName\":\"Questionnaire1\",\"sequence\":2,\"questionnaireTypeId\":2}]";
        protected const string QuestionnaireWithDetailsResponse = "{\"pages\":[{\"questions\":[{\"id\":\"1a810b25-19e5-42c9-9157-0862c2201fa8\",\"name\":null,\"questionnaireId\":\"d63f9b76-a70a-4529-bd64-0a654fc4d9fa\",\"questionType\":1,\"displayName\":\"\",\"pageId\":\"5d78079b-3421-495a-b40e-3181e1206298\",\"questionText\":\"<p>What does the fox say?</p>\",\"sequence\":0,\"questionSettings\":{\"margins\":{\"marginTop\":20,\"marginLeft\":1,\"marginBottom\":100,\"marginRight\":1},\"isSticky\":false,\"isActive\":true,\"isRequired\":true,\"summaryDisplayTextKey\":\"\",\"enabledWhen\":null,\"visibleWhen\":null,\"exportDisplayName\":\"FoxSay\",\"exportDisplayOrder\":null,\"sasLabelType\":null,\"sasLabel\":null,\"sdtmCode\":null,\"sdtmText\":null,\"autoResizeChoices\":true,\"choiceLocation\":\"Below question\",\"minValue\":null,\"maxValue\":null,\"dateTimeFormat\":null,\"minValueTextKey\":\"\",\"maxValueTextKey\":\"\",\"decimalValue\":null,\"suffix\":null,\"languageSpecificHotSpotRequired\":false,\"hotSpotImage\":null,\"languageHotSpotImages\":null,\"enabledWhenBusinessRuleTrueFalseIndicator\":null,\"visibleWhenBusinessRuleTrueFalseIndicator\":null},\"choices\":[]},{\"id\":\"ebda98d6-2b9d-41b3-886c-645f8f503e8b\",\"name\":null,\"questionnaireId\":\"d63f9b76-a70a-4529-bd64-0a654fc4d9fa\",\"questionType\":3,\"displayName\":\"\",\"pageId\":\"5d78079b-3421-495a-b40e-3181e1206298\",\"questionText\":\"<p>favorite color</p>\",\"sequence\":1,\"questionSettings\":{\"margins\":{\"marginTop\":100,\"marginLeft\":1,\"marginBottom\":100,\"marginRight\":1},\"isSticky\":false,\"isActive\":true,\"isRequired\":true,\"summaryDisplayTextKey\":\"\",\"enabledWhen\":null,\"visibleWhen\":null,\"exportDisplayName\":\"color\",\"exportDisplayOrder\":null,\"sasLabelType\":null,\"sasLabel\":null,\"sdtmCode\":null,\"sdtmText\":null,\"autoResizeChoices\":true,\"choiceLocation\":\"Below question\",\"minValue\":null,\"maxValue\":null,\"dateTimeFormat\":null,\"minValueTextKey\":\"\",\"maxValueTextKey\":\"\",\"decimalValue\":null,\"suffix\":null,\"languageSpecificHotSpotRequired\":false,\"hotSpotImage\":null,\"languageHotSpotImages\":null,\"enabledWhenBusinessRuleTrueFalseIndicator\":null,\"visibleWhenBusinessRuleTrueFalseIndicator\":null},\"choices\":[{\"questionId\":\"00000000-0000-0000-0000-000000000000\",\"choiceValue\":1,\"displayText\":\"<p>red</p>\",\"clearOtherResponses\":false,\"margins\":{\"marginTop\":2,\"marginLeft\":100,\"marginBottom\":2,\"marginRight\":100},\"sdtmValue\":null,\"id\":\"8a5775b2-3f62-4e60-99ef-28bf81b9a0c6\",\"sequence\":0,\"choiceHotSpotImage\":null,\"languageChoiceHotSpotImages\":null},{\"questionId\":\"00000000-0000-0000-0000-000000000000\",\"choiceValue\":2,\"displayText\":\"<p>blue</p>\",\"clearOtherResponses\":false,\"margins\":{\"marginTop\":2,\"marginLeft\":100,\"marginBottom\":2,\"marginRight\":100},\"sdtmValue\":null,\"id\":\"5932ae8b-6a8d-4f0e-b306-fe11afff9b39\",\"sequence\":1,\"choiceHotSpotImage\":null,\"languageChoiceHotSpotImages\":null},{\"questionId\":\"00000000-0000-0000-0000-000000000000\",\"choiceValue\":3,\"displayText\":\"<p>green</p>\",\"clearOtherResponses\":false,\"margins\":{\"marginTop\":2,\"marginLeft\":100,\"marginBottom\":2,\"marginRight\":100},\"sdtmValue\":null,\"id\":\"6b9a21a0-6e39-47d8-8d07-e2e85b1c37b4\",\"sequence\":2,\"choiceHotSpotImage\":null,\"languageChoiceHotSpotImages\":null}]}],\"questionnaireId\":\"d63f9b76-a70a-4529-bd64-0a654fc4d9fa\",\"number\":1,\"displayName\":\"Page 1\",\"footerText\":\"\",\"isHandwritingEnabled\":false,\"isScrollForMoreEnabled\":false,\"shouldDisplayOnScreen\":false,\"ShouldDisplayQuestionnaireOnScreen\":null,\"id\":\"5d78079b-3421-495a-b40e-3181e1206298\",\"internalName\":null,\"sequence\":null}],\"url\":null,\"visibleBusinessRuleId\":null,\"enableBusinessRuleId\":null,\"visibleBusinessRuleTrueFalseIndicator\":null,\"enableBusinessRuleTrueFalseIndicator\":null,\"openEndedBusinessRuleId\":null,\"canBlindedSeeAnswers\":false,\"displaySummaryScore\":false,\"isDropdownNavigationEnabled\":false,\"validateQuestionnaireOnSave\":null,\"promptIncompletePagesOnSave\":null,\"enableVisitQuestionnaireId\":null,\"previousDaysEntry\":0,\"previousDaysEdit\":0,\"enforcePreviousDaysEntry\":false,\"allowEdit\":false,\"adaptestSettingsFileId\":null,\"questionnaireTypeId\":2,\"displayName\":\"Tablet Questionnaire\",\"id\":\"d63f9b76-a70a-4529-bd64-0a654fc4d9fa\",\"internalName\":\"Tablet Questionnaire\",\"sequence\":1,\"actionPanel\":{\"canDelete\":true,\"canUpdate\":true,\"acknowledge\":false}}";
        protected const string QuestionsForQuestionnaireResponse = "[{\"id\":\"1a810b25-19e5-42c9-9157-0862c2201fa8\",\"name\":null,\"questionnaireId\":\"d63f9b76-a70a-4529-bd64-0a654fc4d9fa\",\"questionType\":1,\"displayName\":null,\"pageId\":\"5d78079b-3421-495a-b40e-3181e1206298\",\"questionText\":\"<p>What does the fox say?</p>\",\"sequence\":0,\"questionSettings\":{\"margins\":{\"marginTop\":20,\"marginLeft\":1,\"marginBottom\":100,\"marginRight\":1},\"isSticky\":false,\"isActive\":true,\"isRequired\":true,\"summaryDisplayTextKey\":null,\"enabledWhen\":null,\"visibleWhen\":null,\"exportDisplayName\":\"FoxSay\",\"exportDisplayOrder\":null,\"sasLabelType\":null,\"sasLabel\":null,\"sdtmCode\":null,\"sdtmText\":null,\"autoResizeChoices\":true,\"choiceLocation\":\"Below question\",\"minValue\":null,\"maxValue\":null,\"dateTimeFormat\":null,\"minValueTextKey\":null,\"maxValueTextKey\":null,\"decimalValue\":null,\"suffix\":null,\"languageSpecificHotSpotRequired\":false,\"hotSpotImage\":null,\"languageHotSpotImages\":null,\"enabledWhenBusinessRuleTrueFalseIndicator\":null,\"visibleWhenBusinessRuleTrueFalseIndicator\":null},\"choices\":[]},{\"id\":\"ebda98d6-2b9d-41b3-886c-645f8f503e8b\",\"name\":null,\"questionnaireId\":\"d63f9b76-a70a-4529-bd64-0a654fc4d9fa\",\"questionType\":3,\"displayName\":null,\"pageId\":\"5d78079b-3421-495a-b40e-3181e1206298\",\"questionText\":\"<p>favorite color</p>\",\"sequence\":1,\"questionSettings\":{\"margins\":{\"marginTop\":100,\"marginLeft\":1,\"marginBottom\":100,\"marginRight\":1},\"isSticky\":false,\"isActive\":true,\"isRequired\":true,\"summaryDisplayTextKey\":null,\"enabledWhen\":null,\"visibleWhen\":null,\"exportDisplayName\":\"color\",\"exportDisplayOrder\":null,\"sasLabelType\":null,\"sasLabel\":null,\"sdtmCode\":null,\"sdtmText\":null,\"autoResizeChoices\":true,\"choiceLocation\":\"Below question\",\"minValue\":null,\"maxValue\":null,\"dateTimeFormat\":null,\"minValueTextKey\":null,\"maxValueTextKey\":null,\"decimalValue\":null,\"suffix\":null,\"languageSpecificHotSpotRequired\":false,\"hotSpotImage\":null,\"languageHotSpotImages\":null,\"enabledWhenBusinessRuleTrueFalseIndicator\":null,\"visibleWhenBusinessRuleTrueFalseIndicator\":null},\"choices\":[{\"questionId\":\"00000000-0000-0000-0000-000000000000\",\"choiceValue\":1,\"displayText\":null,\"clearOtherResponses\":false,\"margins\":{\"marginTop\":2,\"marginLeft\":100,\"marginBottom\":2,\"marginRight\":100},\"sdtmValue\":null,\"id\":\"8a5775b2-3f62-4e60-99ef-28bf81b9a0c6\",\"sequence\":0,\"choiceHotSpotImage\":null,\"languageChoiceHotSpotImages\":null},{\"questionId\":\"00000000-0000-0000-0000-000000000000\",\"choiceValue\":2,\"displayText\":null,\"clearOtherResponses\":false,\"margins\":{\"marginTop\":2,\"marginLeft\":100,\"marginBottom\":2,\"marginRight\":100},\"sdtmValue\":null,\"id\":\"5932ae8b-6a8d-4f0e-b306-fe11afff9b39\",\"sequence\":1,\"choiceHotSpotImage\":null,\"languageChoiceHotSpotImages\":null},{\"questionId\":\"00000000-0000-0000-0000-000000000000\",\"choiceValue\":3,\"displayText\":null,\"clearOtherResponses\":false,\"margins\":{\"marginTop\":2,\"marginLeft\":100,\"marginBottom\":2,\"marginRight\":100},\"sdtmValue\":null,\"id\":\"6b9a21a0-6e39-47d8-8d07-e2e85b1c37b4\",\"sequence\":2,\"choiceHotSpotImage\":null,\"languageChoiceHotSpotImages\":null},{\"questionId\":\"00000000-0000-0000-0000-000000000000\",\"choiceValue\":4,\"displayText\":null,\"clearOtherResponses\":false,\"margins\":{\"marginTop\":2,\"marginLeft\":100,\"marginBottom\":2,\"marginRight\":100},\"sdtmValue\":null,\"id\":\"814ec0a0-47b8-4d79-a54b-ff4cadf8fa34\",\"sequence\":3,\"choiceHotSpotImage\":null,\"languageChoiceHotSpotImages\":null}]}]";

        protected QuestionnaireServiceTestBase()
            : base(AllQuestionnairesResponse)
        { }

        protected IQuestionnaireService GetService()
        {
            var service = new QuestionnaireService(
                MockHttpFactory.Object, 
                MemoryCache,
                MockSessionService.Object,
                TestServiceSettings,
                _authSettings,
                MockAuthService.Object);

            return service;
        }
    }
}
